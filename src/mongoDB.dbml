Project rally_database {
  database_type: 'MongoDB'
  Note: 'Rally MongoDB Database Schema'
}

Enum user_status {
  active [note: 'User account is active and in good standing']
  away [note: 'User account is away from their device']
  inactive [note: 'User account is inactive/dormant']
  suspended [note: 'User account is temporarily suspended']
  banned [note: 'User account is permanently banned']
}

Table users as u {
  id objectid [primary key, note: 'MongoDB ObjectId']
  firebase_uid varchar(255) [not null, unique, note: 'Firebase Authentication UID']
  username varchar(255) [not null, unique, note: 'Unique username for login']
  first_name varchar(255) [note: 'User first name']
  last_name varchar(255) [note: 'User last name']
  avatar_url varchar(512) [note: 'URL to user avatar image']
  bio_text text [note: 'User biography or profile description']
  status user_status [default: 'active', note: 'Current status of the user account']
  is_onboarding boolean [default: true, note: 'Has the user started onboarding?']
  is_email_verified boolean [default: false, note: 'Has the user verified their email?']
  phone_number varchar(20) [note: 'User phone number for contact']
  email varchar(255) [not null, unique, note: 'User email address']
  created_at timestamp [default: `now()`, note: 'Account creation timestamp']
  updated_at timestamp [note: 'Last profile update timestamp']
  is_private boolean [default: false, note: 'If true, follow requests require approval']
  followers_count int [default: 0, note: 'Cached count of followers']
  following_count int [default: 0, note: 'Cached count of users being followed']
  Note: 'User accounts table'
}

Enum follow_status {
  pending [note: 'Follow request sent, awaiting approval (for private accounts)']
  accepted [note: 'Follow is active']
  blocked [note: 'User has blocked this follower']
}

// Hybrid system: Followers/Following for discovery, Mutual follows = Friends for session invites
Table follows {
  id objectid [primary key, note: 'MongoDB ObjectId']
  follower_id objectid [ref: > users.id, not null, note: 'User who is following']
  following_id objectid [ref: > users.id, not null, note: 'User being followed']
  status follow_status [default: 'accepted', note: 'Current status of the follow']
  created_at timestamp [default: `now()`, note: 'When the follow was initiated']
  updated_at timestamp [note: 'Last status change timestamp']

  indexes {
    (follower_id, following_id) [unique, note: 'Prevent duplicate follows']
    follower_id [note: 'Query: who does this user follow?']
    following_id [note: 'Query: who follows this user?']
  }

  Note: '''
  Follow relationships between users.
  - One-way follows for discovery/feed
  - Mutual follows (A→B AND B→A both accepted) = "Friends" for session invites
  '''
}

Enum session_status {
  planning [note: 'Session is currently being planned']
  confirmed [note: 'Session details are confirmed']
  completed [note: 'Session has taken place']
  cancelled [note: 'Session has been cancelled']
}

Enum participant_role {
  owner [note: 'Creator and admin of the session']
  editor [note: 'Can edit session details and spots']
  participant [note: 'Can only view and experience the session']
}

Enum participation_status {
  invited [note: 'User has been invited but not yet responded']
  joined [note: 'User has accepted and joined the session']
  declined [note: 'User has declined the invitation']
  left [note: 'User has left the session']
}

Table sessions {
  id objectid [primary key, note: 'MongoDB ObjectId']
  owner_id objectid [ref: > users.id, not null, note: 'User who created the session']
  name varchar(255) [not null, note: 'Name of the trip/hangout']
  description text [note: 'Description or goal of the session']
  cover_image_url varchar(512) [note: 'Cover image for the session']
  status session_status [default: 'planning', note: 'Current status of the session']
  start_date timestamp [note: 'Overall start date of the trip']
  end_date timestamp [note: 'Overall end date of the trip']
  created_at timestamp [default: `now()`, note: 'Session creation timestamp']
  updated_at timestamp [note: 'Last update timestamp']
  Note: 'Sessions table representing trips or hangouts'
}

Table destinations {
  id objectid [primary key, note: 'MongoDB ObjectId']
  session_id objectid [ref: > sessions.id, not null, note: 'The session this destination belongs to']
  google_place_id varchar(255) [note: 'Google Maps Place ID']
  name varchar(255) [not null, note: 'Name of the location']
  lat double [note: 'Latitude']
  lng double [note: 'Longitude']
  start_time timestamp [note: 'Planned arrival or start time']
  end_time timestamp [note: 'Planned departure or end time']
  notes text [note: 'Notes for this specific destination']
  visit_order int [note: 'Order of this destination in the itinerary']
  created_at timestamp [default: `now()`]
  updated_at timestamp
  Note: 'Destinations within a session'
}

Enum activity_status {
  planned [note: 'Activity is planned but not started']
  in_progress [note: 'Activity is currently happening']
  completed [note: 'Activity has been completed']
  skipped [note: 'Activity was skipped']
}

Table activities {
  id objectid [primary key, note: 'MongoDB ObjectId']
  destination_id objectid [ref: > destinations.id, not null, note: 'The destination this activity belongs to']
  name varchar(255) [not null, note: 'Name of the activity']
  description text [note: 'Description of the activity']
  status activity_status [default: 'planned', note: 'Current status of the activity']
  google_place_id varchar(255) [note: 'Google Maps Place ID (optional)']
  lat double [note: 'Latitude (optional)']
  lng double [note: 'Longitude (optional)']
  start_time timestamp [note: 'Planned start time']
  end_time timestamp [note: 'Planned end time']
  notes text [note: 'Additional notes for this activity']
  activity_order int [note: 'Order of this activity within the destination']
  created_at timestamp [default: `now()`, note: 'Activity creation timestamp']
  updated_at timestamp [note: 'Last update timestamp']
  Note: 'Activities within a destination'
}

Table session_participants {
  id objectid [primary key, note: 'MongoDB ObjectId']
  session_id objectid [ref: > sessions.id, not null, note: 'The session']
  user_id objectid [ref: > users.id, not null, note: 'The participant user']
  role participant_role [default: 'viewer', not null, note: 'Access level of the participant']
  status participation_status [default: 'invited', not null, note: 'Invitation status']
  joined_at timestamp [note: 'When the user joined']
  invited_at timestamp [default: `now()`, note: 'When the invitation was sent']
  Note: 'Join table for Users and Sessions with roles'
}
